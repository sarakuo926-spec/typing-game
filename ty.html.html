<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥‡å¹»æ‰“å­—é€ƒç”Ÿï¼šæš—å½±è¿½é€</title>
    <style>
        :root {
            --bg-color: #1a1a15;
            --clay-brown: #4e4433;
            --forest-green: #2d3e2d;
            --vintage-yellow: #d4b483;
            --danger-red: #8b0000;
            --success-green: #2e8b57;
            --text-color: #e0d8c0;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Palatino Linotype', 'Book Antiqua', serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* éŠæˆ²èˆå° */
        #game-stage {
            width: 90%;
            max-width: 800px;
            background: linear-gradient(180deg, #252520 0%, #1a1a15 100%);
            border: 4px solid var(--clay-brown);
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            position: relative;
        }

        /* è¿½é€å‹•ç•«è¦–è¦ºå€ */
        #visual-area {
            height: 120px;
            border-bottom: 2px solid var(--clay-brown);
            margin-bottom: 30px;
            position: relative;
            background: rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            align-items: flex-end;
        }

        .sprite {
            font-size: 50px;
            position: absolute;
            bottom: 10px;
            transition: left 0.5s ease;
        }

        #monster { left: 10px; filter: drop-shadow(0 0 10px red); }
        
        /* ç©å®¶åœ–ç¤ºé¡åƒç¿»è½‰ */
        #player { 
            left: 150px; 
            filter: drop-shadow(0 0 10px var(--vintage-yellow)); 
            transform: scaleX(-1); /* é¡åƒç¿»è½‰ */
        }

        /* æ•¸æ“šæ¬„ä½ */
        #stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            font-size: 1.2rem;
            color: var(--vintage-yellow);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* å¥å­é¡¯ç¤º */
        #sentence-display {
            font-size: 1.8rem;
            line-height: 1.6;
            margin-bottom: 25px;
            text-align: left;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            min-height: 80px;
            border-left: 5px solid var(--clay-brown);
        }

        .current-char { text-decoration: underline; color: var(--vintage-yellow); }
        .correct-char { color: var(--success-green); }
        .wrong-char { color: var(--danger-red); background: rgba(139, 0, 0, 0.2); }

        /* è¼¸å…¥æ¡† */
        #typing-input {
            width: 100%;
            padding: 15px;
            font-size: 1.5rem;
            background-color: var(--clay-brown);
            border: 2px solid var(--vintage-yellow);
            border-radius: 8px;
            color: #fff;
            outline: none;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        #typing-input.correct { background-color: var(--success-green); }
        #typing-input.error { background-color: var(--danger-red); }

        /* æŒ‰éˆ• */
        .btn-container {
            margin-top: 30px;
            display: flex;
            gap: 20px;
        }

        button {
            padding: 12px 30px;
            font-size: 1.1rem;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: var(--vintage-yellow);
            color: #1a1a15;
            font-weight: bold;
            transition: transform 0.2s, background 0.2s;
        }

        button:hover {
            transform: scale(1.05);
            background: #e5c9a0;
        }

        button:active { transform: scale(0.95); }

        /* è¨ˆæ™‚å™¨èˆ‡è­¦å‘Š */
        #timer-box {
            position: absolute;
            top: 10px;
            right: 20px;
            font-family: monospace;
            color: var(--danger-red);
            font-size: 1.2rem;
        }

        /* éŠæˆ²çµæŸæ¨¡æ…‹è¦–çª— */
        #overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        #overlay h2 { font-size: 3rem; color: var(--danger-red); margin-bottom: 20px; }
    </style>
</head>
<body>

    <div id="overlay">
        <h2 id="overlay-title">ä½ è¢«æŠ“ä½äº†ï¼</h2>
        <p id="final-stats" style="font-size: 1.5rem; margin-bottom: 20px;"></p>
        <button onclick="startGame()">é‡ç”Ÿå†æˆ°</button>
    </div>

    <div id="game-stage">
        <div id="timer-box">å‰©é¤˜æ™‚é–“: <span id="time-left">03:00</span></div>
        
        <div id="visual-area">
            <div id="monster" class="sprite">ğŸ‘¹</div>
            <div id="player" class="sprite">ğŸƒ</div>
        </div>

        <div id="stats">
            <div>WPM: <span id="wpm">0</span></div>
            <div>æ­£ç¢ºç‡: <span id="accuracy">100%</span></div>
        </div>

        <div id="sentence-display">è«‹é»æ“Šé–‹å§‹éŠæˆ²æŒ‰éˆ•ä¾†æŒ‘æˆ°é€ƒäº¡...</div>

        <input type="text" id="typing-input" placeholder="åœ¨é€™è£¡é–‹å§‹è¼¸å…¥..." disabled>

        <div class="btn-container">
            <button id="start-btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
            <button id="reset-btn" onclick="resetGame()">é‡æ–°é–‹å§‹</button>
        </div>
    </div>

    <script>
        const sentences = [
            "The ancient dragon slept beneath the mountain of gold.",
            "Shadows crawl through the forgotten corridors of the castle.",
            "A brave knight must face the darkness to save the kingdom.",
            "Magic is a double-edged sword that can heal or destroy.",
            "The forest whispers secrets to those who listen carefully.",
            "Under the moonlight, the ruins of the temple glowed softly.",
            "Heroic deeds are often born from the smallest of hearts.",
            "Beware of the creatures that hunt in the deepest of nights."
        ];

        let currentSentence = "";
        let startTime = null;
        let timerInterval = null;
        let gameActive = false;
        let totalCharsTyped = 0;
        let correctCharsTyped = 0;
        let timeLimit = 180; // 3åˆ†é˜ = 180ç§’

        const display = document.getElementById('sentence-display');
        const input = document.getElementById('typing-input');
        const wpmDisplay = document.getElementById('wpm');
        const accDisplay = document.getElementById('accuracy');
        const timeLeftDisplay = document.getElementById('time-left');
        const player = document.getElementById('player');
        const monster = document.getElementById('monster');
        const overlay = document.getElementById('overlay');

        function startGame() {
            overlay.style.display = 'none';
            gameActive = true;
            input.disabled = false;
            input.value = "";
            input.focus();
            totalCharsTyped = 0;
            correctCharsTyped = 0;
            startTime = new Date();
            timeLimit = 180;
            
            updateStats();
            nextSentence();
            startTimer();
            updateVisuals(0);
        }

        function nextSentence() {
            currentSentence = sentences[Math.floor(Math.random() * sentences.length)];
            renderSentence();
            input.value = "";
            input.className = "";
        }

        function renderSentence() {
            display.innerHTML = currentSentence.split('').map((char, index) => {
                return `<span class="char">${char}</span>`;
            }).join('');
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLimit--;
                let mins = Math.floor(timeLimit / 60);
                let secs = timeLimit % 60;
                timeLeftDisplay.innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

                // æ€ªç‰©æ…¢æ…¢é€¼è¿‘ (æ ¹æ“šæ™‚é–“)
                const monsterPos = 10 + ((180 - timeLimit) / 180) * 100;
                monster.style.left = monsterPos + "px";

                if (timeLimit <= 0) {
                    endGame(false);
                }
            }, 1000);
        }

        input.addEventListener('input', (e) => {
            if (!gameActive) return;

            const val = input.value;
            const target = currentSentence.substring(0, val.length);
            const chars = display.querySelectorAll('.char');

            totalCharsTyped++;

            // æª¢æŸ¥è¼¸å…¥æ˜¯å¦æ­£ç¢º
            if (val === target) {
                input.className = "correct";
                correctCharsTyped++;
                
                // è¦–è¦ºæ•ˆæœï¼šè·‘é–‹
                const progress = val.length / currentSentence.length;
                updateVisuals(progress);

                // å®Œæˆå¥å­
                if (val === currentSentence) {
                    nextSentence();
                    updateVisuals(0);
                }
            } else {
                input.className = "error";
            }

            // æ¸²æŸ“å­—é«”é¡è‰²
            chars.forEach((span, i) => {
                if (i < val.length) {
                    if (val[i] === currentSentence[i]) {
                        span.className = "char correct-char";
                    } else {
                        span.className = "char wrong-char";
                    }
                } else {
                    span.className = "char";
                }
            });

            updateStats();
        });

        function updateVisuals(progress) {
            // ç©å®¶ä½ç½®å¾ 150px åˆ° 700px ä¹‹é–“è®Šå‹•
            const basePos = 150;
            const maxMove = 550;
            player.style.left = (basePos + (progress * maxMove)) + "px";
        }

        function updateStats() {
            const now = new Date();
            const timeDiff = (now - startTime) / 1000 / 60; // åˆ†é˜
            
            // WPM è¨ˆç®— (æ¨™æº–ï¼š5å€‹å­—å…ƒç‚ºä¸€å€‹å–®å­—)
            const wpm = timeDiff > 0 ? Math.round((correctCharsTyped / 5) / timeDiff) : 0;
            wpmDisplay.innerText = wpm;

            // æ­£ç¢ºç‡
            const acc = totalCharsTyped > 0 ? Math.round((correctCharsTyped / totalCharsTyped) * 100) : 100;
            accDisplay.innerText = acc + "%";
        }

        function endGame(success) {
            gameActive = false;
            clearInterval(timerInterval);
            input.disabled = true;
            overlay.style.display = 'flex';
            document.getElementById('overlay-title').innerText = success ? "æˆåŠŸé€ƒè„«ï¼" : "ä½ è¢«æŠ“ä½äº†ï¼";
            document.getElementById('final-stats').innerText = `æœ€çµ‚ WPM: ${wpmDisplay.innerText} | æ­£ç¢ºç‡: ${accDisplay.innerText}`;
        }

        function resetGame() {
            clearInterval(timerInterval);
            gameActive = false;
            input.value = "";
            input.disabled = true;
            display.innerText = "è«‹é»æ“Šé–‹å§‹éŠæˆ²æŒ‰éˆ•ä¾†æŒ‘æˆ°é€ƒäº¡...";
            wpmDisplay.innerText = "0";
            accDisplay.innerText = "100%";
            timeLeftDisplay.innerText = "03:00";
            player.style.left = "150px";
            monster.style.left = "10px";
            input.className = "";
        }
    </script>
</body>
</html>